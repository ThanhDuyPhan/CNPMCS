(function(){$(function(){function i(){e.ajax.reload()}function o(n){if(n.userName===app.consts.userManagement.defaultAdminUserName){abp.message.warn(app.localize("{0}UserCannotBeDeleted",app.consts.userManagement.defaultAdminUserName));return}abp.message.confirm(app.localize("UserDeleteWarningMessage",n.userName),app.localize("AreYouSure"),function(r){r&&t.deleteUser({id:n.id}).done(function(){i(!0);abp.notify.success(app.localize("SuccessfullyDeleted"))})})}var u=$("#UsersTable"),t=abp.services.app.user,n={create:abp.auth.hasPermission("Pages.Administration.Users.Create"),edit:abp.auth.hasPermission("Pages.Administration.Users.Edit"),changePermissions:abp.auth.hasPermission("Pages.Administration.Users.ChangePermissions"),impersonation:abp.auth.hasPermission("Pages.Administration.Users.Impersonation"),"delete":abp.auth.hasPermission("Pages.Administration.Users.Delete")},r=new app.ModalManager({viewUrl:abp.appPath+"AppAreaName/Users/CreateOrEditModal",scriptUrl:abp.appPath+"view-resources/Areas/AppAreaName/Views/Users/_CreateOrEditModal.js",modalClass:"CreateOrEditUserModal"}),f=new app.ModalManager({viewUrl:abp.appPath+"AppAreaName/Users/PermissionsModal",scriptUrl:abp.appPath+"view-resources/Areas/AppAreaName/Views/Users/_PermissionsModal.js",modalClass:"UserPermissionsModal"}),e=u.DataTable({paging:!0,serverSide:!0,processing:!0,listAction:{ajaxFunction:t.getUsers,inputFilter:function(){return{filter:$("#UsersTableFilter").val(),permission:$("#PermissionSelectionCombo").val(),role:$("#RoleSelectionCombo").val()}}},columnDefs:[{className:"control responsive",orderable:!1,render:function(){return""},targets:0},{targets:1,data:null,orderable:!1,autoWidth:!1,defaultContent:"",rowAction:{text:'<i class="fa fa-cog"><\/i> '+app.localize("Actions")+' <span class="caret"><\/span>',items:[{text:app.localize("LoginAsThisUser"),visible:function(t){return n.impersonation&&t.record.id!==abp.session.userId},action:function(n){abp.ajax({url:abp.appPath+"Account/Impersonate",data:JSON.stringify({tenantId:abp.session.tenantId,userId:n.record.id})})}},{text:app.localize("Edit"),visible:function(){return n.edit},action:function(n){r.open({id:n.record.id})}},{text:app.localize("Permissions"),visible:function(){return n.changePermissions},action:function(n){f.open({id:n.record.id})}},{text:app.localize("Unlock"),visible:function(){return n.changePermissions},action:function(n){t.unlockUser({id:n.record.id}).done(function(){abp.notify.success(app.localize("UnlockedTheUser",n.record.userName))})}},{text:app.localize("Delete"),visible:function(){return n.delete},action:function(n){o(n.record)}}]}},{targets:2,data:"userName",render:function(n,t,i){var r=$("<span/>");if(i.profilePictureId){var u="/Profile/GetProfilePictureById?id="+i.profilePictureId,f=$("<a/>").attr("href",u).attr("target","_blank"),e=$("<img/>").addClass("img-circle").attr("src",u);f.append(e);r.append(f)}return r.append(n),r[0].outerHTML}},{targets:3,data:"name"},{targets:4,data:"surname"},{targets:5,data:"roles",render:function(n){for(var t="",i=0;i<n.length;i++)t.length&&(t=t+", "),t=t+n[i].roleName;return t}},{targets:6,data:"emailAddress"},{targets:7,data:"isEmailConfirmed",render:function(n){return n?'<span class="label label-success">'+app.localize("Yes")+"<\/span>":'<span class="label label-default">'+app.localize("No")+"<\/span>"}},{targets:8,data:"isActive",render:function(n){return n?'<span class="label label-success">'+app.localize("Yes")+"<\/span>":'<span class="label label-default">'+app.localize("No")+"<\/span>"}},{targets:9,data:"lastLoginTime",render:function(n){return n?moment(n).format("L"):""}},{targets:10,data:"creationTime",render:function(n){return moment(n).format("L")}}]});$("#ShowAdvancedFiltersSpan").click(function(){$("#ShowAdvancedFiltersSpan").hide();$("#HideAdvancedFiltersSpan").show();$("#AdvacedAuditFiltersArea").slideDown()});$("#HideAdvancedFiltersSpan").click(function(){$("#HideAdvancedFiltersSpan").hide();$("#ShowAdvancedFiltersSpan").show();$("#AdvacedAuditFiltersArea").slideUp()});$("#CreateNewUserButton").click(function(){r.open()});$("#ExportUsersToExcelButton").click(function(){t.getUsersToExcel({}).done(function(n){app.downloadTempFile(n)})});$("#GetUsersButton, #RefreshUserListButton").click(function(n){n.preventDefault();i()});$("#UsersTableFilter").on("keydown",function(n){n.keyCode===13&&(n.preventDefault(),i())});abp.event.on("app.createOrEditUserModalSaved",function(){i()});$("#UsersTableFilter").focus()})})();