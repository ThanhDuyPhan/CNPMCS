(function(n){n(function(){function c(){var t={};return u.serializeArray().map(function(n){t[abp.utils.toCamelCase(n.name)]=n.value}),n.extend(t,r)}function l(){var t={};return f.serializeArray().map(function(n){t[abp.utils.toCamelCase(n.name)]=n.value}),n.extend(t,i)}function e(){s.ajax.reload()}function o(){h.ajax.reload()}function y(n){try{var t=JSON.parse(n);return JSON.stringify(t,null,4)}catch(i){return n}}function p(n){var t=new app.ModalManager({viewUrl:abp.appPath+"AppAreaName/AuditLogs/EntityChangeDetailModal",modalClass:"EntityChangeDetailModal"});t.open({entityChangeListDto:n})}function w(t){n("#AuditLogDetailModal_UserName").html(t.userName);n("#AuditLogDetailModal_ClientIpAddress").html(t.clientIpAddress);n("#AuditLogDetailModal_ClientName").html(t.clientName);n("#AuditLogDetailModal_BrowserInfo").html(t.browserInfo);n("#AuditLogDetailModal_ServiceName").html(t.serviceName);n("#AuditLogDetailModal_MethodName").html(t.methodName);n("#AuditLogDetailModal_ExecutionTime").html(moment(t.executionTime).fromNow()+" ("+moment(t.executionTime).format("YYYY-MM-DD hh:mm:ss")+")");n("#AuditLogDetailModal_Duration").html(app.localize("Xms",t.executionDuration));n("#AuditLogDetailModal_Parameters").html(y(t.parameters));t.impersonatorUserId?n("#AuditLogDetailModal_ImpersonatorInfo").show():n("#AuditLogDetailModal_ImpersonatorInfo").hide();t.exception?(n("#AuditLogDetailModal_Success").hide(),n("#AuditLogDetailModal_Exception").show(),n("#AuditLogDetailModal_Exception").html(t.exception)):(n("#AuditLogDetailModal_Exception").hide(),n("#AuditLogDetailModal_Success").show());t.customData?(n("#AuditLogDetailModal_CustomData_None").hide(),n("#AuditLogDetailModal_CustomData").show(),n("#AuditLogDetailModal_CustomData").html(t.customData)):(n("#AuditLogDetailModal_CustomData").hide(),n("#AuditLogDetailModal_CustomData_None").show());n("#AuditLogDetailModal").modal("show")}var a=n("#AuditLogsTable"),u=n("#AuditLogFilterForm"),v=n("#EntityChangesTable"),f=n("#EntityChangeFilterForm"),t=abp.services.app.auditLog,i,r=i={startDate:moment().startOf("day"),endDate:moment().endOf("day")},s,h;u.find("input.date-range-picker").daterangepicker(n.extend(!0,app.createDateRangePickerOptions(),r),function(n,t){r.startDate=n.format("YYYY-MM-DDT00:00:00Z");r.endDate=t.format("YYYY-MM-DDT23:59:59.999Z");e()});f.find("input.date-range-picker").daterangepicker(n.extend(!0,app.createDateRangePickerOptions(),i),function(n,t){i.startDate=n.format("YYYY-MM-DDT00:00:00Z");i.endDate=t.format("YYYY-MM-DDT23:59:59.999Z");o()});t.getEntityHistoryObjectTypes().done(function(t){n.each(t,function(t,i){n("#EntityTypeFullName").append(n("<option><\/option>").text(i.name).val(i.value))})});s=a.DataTable({paging:!0,serverSide:!0,processing:!0,listAction:{ajaxFunction:t.getAuditLogs,inputFilter:function(){return c()}},columnDefs:[{className:"control responsive",orderable:!1,render:function(){return""},targets:0},{targets:1,data:null,orderable:!1,defaultContent:"",rowAction:{element:n("<div/>").addClass("text-center").append(n("<button/>").addClass("btn m-btn m-btn--hover-accent m-btn--icon m-btn--icon-only m-btn--pill").attr("title",app.localize("AuditLogDetail")).append(n("<i/>").addClass("la la-search"))).click(function(){w(n(this).data())})}},{targets:2,data:"exception",orderable:!1,render:function(t){var i=n("<div/>").addClass("text-center");return t?i.append(n("<i/>").addClass("fa fa-warning m--font-warning").attr("title",app.localize("HasError"))):i.append(n("<i/>").addClass("fa fa-check-circle m--font-success").attr("title",app.localize("Success"))),i[0].outerHTML}},{targets:3,data:"executionTime",render:function(n){return moment(n).format("YYYY-MM-DD HH:mm:ss")}},{targets:4,data:"userName"},{targets:5,data:"serviceName"},{targets:6,data:"methodName"},{targets:7,data:"executionDuration",render:function(n){return app.localize("Xms",n)}},{targets:8,data:"clientIpAddress",orderable:!1},{targets:9,data:"clientName"},{targets:10,data:"browserInfo",render:function(t){return n("<span/>").text(abp.utils.truncateStringWithPostfix(t,32)).attr("title",t)[0].outerHTML}}]});h=v.DataTable({paging:!0,serverSide:!0,processing:!0,listAction:{ajaxFunction:t.getEntityChanges,inputFilter:function(){return l()}},columnDefs:[{className:"control responsive",orderable:!1,render:function(){return""},targets:0},{targets:1,data:null,orderable:!1,defaultContent:"",rowAction:{element:n("<div/>").addClass("text-center").append(n("<button/>").addClass("btn m-btn m-btn--hover-accent m-btn--icon m-btn--icon-only m-btn--pill").attr("title",app.localize("EntityChangeDetail")).append(n("<i/>").addClass("la la-search"))).click(function(){p(n(this).data())})}},{targets:2,data:"changeTypeName",orderable:!1,render:function(n){return app.localize(n)}},{targets:3,data:"entityTypeFullName",render:function(n){return app.localize(n)}},{targets:4,data:"userName"},{targets:5,data:"changeTime",render:function(n){return moment(n).format("YYYY-MM-DD HH:mm:ss")}}]});n("#RefreshAuditLogsButton").click(function(n){n.preventDefault();e()});n("#RefreshEntityChangesButton").click(function(n){n.preventDefault();o()});n("#ExportAuditLogsToExcelButton").click(function(n){n.preventDefault();t.getAuditLogsToExcel(c()).done(function(n){app.downloadTempFile(n)})});n("#ExportEntityChangesToExcelButton").click(function(n){n.preventDefault();t.getEntityChangesToExcel(l()).done(function(n){app.downloadTempFile(n)})});n("#ShowAdvancedFiltersSpan").click(function(){n("#ShowAdvancedFiltersSpan").hide();n("#HideAdvancedFiltersSpan").show();n("#AdvacedAuditFiltersArea").slideDown()});n("#HideAdvancedFiltersSpan").click(function(){n("#HideAdvancedFiltersSpan").hide();n("#ShowAdvancedFiltersSpan").show();n("#AdvacedAuditFiltersArea").slideUp()});u.keydown(function(n){n.which===13&&(n.preventDefault(),e())});f.keydown(function(n){n.which===13&&(n.preventDefault(),o())})})})(jQuery);