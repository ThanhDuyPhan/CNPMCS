(function(){$(function(){function e(){$("#Setting_AllowSelfRegistration").is(":checked")?f.slideDown("fast"):f.slideUp("fast")}function o(){$("#Settings_SmtpUseDefaultCredentials").is(":checked")?t.slideUp("fast"):t.slideDown("fast")}function s(){$("#Setting_LdapIsEnabled").is(":checked")?i.slideDown("fast"):i.slideUp("fast")}function h(){$("#Setting_UserLockOut_IsEnabled").is(":checked")?r.slideDown("fast"):r.slideUp("fast")}function c(){$("#Setting_TwoFactorLogin_IsEnabled").is(":checked")?u.slideDown("fast"):u.slideUp("fast")}function p(){var n=$("#DefaultPasswordComplexitySettingsForm input:disabled"),t;return n.removeAttr("disabled"),t=$("#DefaultPasswordComplexitySettingsForm").serializeFormToObject(),n.attr("disabled","disabled"),t}function l(n){$("#AppLogo").attr("src",n)}function a(n){$("#TenantCustomCss").remove();n&&$("head").append('<link id="TenantCustomCss" href="'+n+'" rel="stylesheet"/>')}var n=abp.services.app.tenantSettings,v=$("#GeneralSettingsForm [name=Timezone]").val(),y=$("#GeneralSettingsForm [name=TimezoneForComparison]").val()===abp.setting.values["Abp.Timing.TimeZone"],f=$("#FormBasedRegistrationSettingsForm").find("input[name=IsNewRegisteredUserActiveByDefault],input[name=UseCaptchaOnRegistration]").closest(".md-checkbox"),t,i,r,u;$("#Setting_AllowSelfRegistration").change(function(){e()});e();t=$("#EmailSmtpSettingsForm").find("input[name=SmtpDomain],input[name=SmtpUserName],input[name=SmtpPassword]").closest(".form-group");$("#Settings_SmtpUseDefaultCredentials").change(function(){o()});o();i=$("#LdapSettingsForm").find("input[name=Domain],input[name=UserName],input[name=Password]").closest(".form-group");s();$("#Setting_LdapIsEnabled").change(function(){s()});r=$("#UserLockOutSettingsForm").find("input").not("#Setting_UserLockOut_IsEnabled").closest(".form-group");h();$("#Setting_UserLockOut_IsEnabled").change(function(){h()});u=$("#TwoFactorLoginSettingsForm").find("input").not("#Setting_TwoFactorLogin_IsEnabled").closest(".md-checkbox");c();$("#Setting_TwoFactorLogin_IsEnabled").change(function(){c()});$("#Setting_PasswordComplexity_UseDefaultSettings").change(function(){$("#Setting_PasswordComplexity_UseDefaultSettings").is(":checked")?($("#DefaultPasswordComplexitySettingsForm").show(),$("#PasswordComplexitySettingsForm").hide()):($("#DefaultPasswordComplexitySettingsForm").hide(),$("#PasswordComplexitySettingsForm").show())});$("#SettingsLogoUploadForm").ajaxForm({beforeSubmit:function(){var r=$("#SettingsLogoUploadForm input[name=ApplicationLogoImage]"),t=r.get()[0].files,n,i;return t.length?(n=t[0],i="|"+n.type.slice(n.type.lastIndexOf("/")+1)+"|","|jpg|jpeg|png|gif|".indexOf(i)===-1)?(abp.message.warn(app.localize("File_Invalid_Type_Error")),!1):n.size>30720?(abp.message.warn(app.localize("File_SizeLimit_Error")),!1):!0:!1},success:function(n){n.success?(l(abp.appPath+"TenantCustomization/GetLogo?id="+n.result.id),abp.notify.info(app.localize("SavedSuccessfully"))):abp.message.error(n.error.message)}});$("#SettingsLogoUploadForm button[type=reset]").click(function(){n.clearLogo().done(function(){l(abp.appPath+"Common/Images/app-logo-on-light.png");abp.notify.info(app.localize("ClearedSuccessfully"))})});$("#SettingsCustomCssUploadForm").ajaxForm({beforeSubmit:function(){var r=$("#SettingsCustomCssUploadForm input[name=CustomCssFile]"),t=r.get()[0].files,n,i;return t.length?(n=t[0],i="|"+n.type.slice(n.type.lastIndexOf("/")+1)+"|","|css|".indexOf(i)===-1)?(abp.message.warn(app.localize("File_Invalid_Type_Error")),!1):n.size>1048576?(abp.message.warn(app.localize("File_SizeLimit_Error")),!1):!0:!1},success:function(n){n.success?(a(abp.appPath+"TenantCustomization/GetCustomCss?id="+n.result.id),abp.notify.info(app.localize("SavedSuccessfully"))):abp.message.error(n.error.message)}});$("#SettingsCustomCssUploadForm button[type=reset]").click(function(){n.clearCustomCss().done(function(){a(null);abp.notify.info(app.localize("ClearedSuccessfully"))})});$("#SaveAllSettingsButton").click(function(){n.updateAllSettings({general:$("#GeneralSettingsForm").serializeFormToObject(),userManagement:$.extend($("#FormBasedRegistrationSettingsForm").serializeFormToObject(),$("#OtherSettingsForm").serializeFormToObject()),email:$("#EmailSmtpSettingsForm").serializeFormToObject(),ldap:$("#LdapSettingsForm").serializeFormToObject(),billing:$("#BillingSettingsForm").serializeFormToObject(),security:{useDefaultPasswordComplexitySettings:$("#Setting_PasswordComplexity_UseDefaultSettings").is(":checked"),passwordComplexity:$("#PasswordComplexitySettingsForm").serializeFormToObject(),defaultPasswordComplexity:p(),userLockOut:$("#UserLockOutSettingsForm").serializeFormToObject(),twoFactorLogin:$("#TwoFactorLoginSettingsForm").serializeFormToObject()}}).done(function(){abp.notify.info(app.localize("SavedSuccessfully"));var n=$("#GeneralSettingsForm [name=Timezone]").val();abp.clock.provider.supportsMultipleTimezone&&y&&v!==n&&abp.message.info(app.localize("TimeZoneSettingChangedRefreshPageNotification")).done(function(){window.location.reload()})})});$("#SendTestEmailButton").click(function(){n.sendTestEmail({emailAddress:$("#TestEmailAddressInput").val()}).done(function(){abp.notify.info(app.localize("TestEmailSentSuccessfully"))})})})})();