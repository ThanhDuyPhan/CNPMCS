var FeaturesTree=function(n){return function(){function r(r){function f(){t.find(".jstree-node").each(function(){var r=n(this),o=r.find(".jstree-anchor"),t=JSON.parse(r.attr("data-feature")),s=r.attr("data-feature-value"),f,i,e;if(t&&t.inputType&&t.inputType.name!="CHECKBOX")if(t.inputType.name=="SINGLE_LINE_STRING"){if(!r.find(".feature-tree-textbox").length){o.find(".jstree-checkbox").hide();f="text";t.inputType.validator&&t.inputType.validator.name=="NUMERIC"&&(f="number");i=n('<input class="feature-tree-textbox" type="'+f+'" />').val(s);f=="number"?(i.attr("min",t.inputType.validator.minValue),i.attr("max",t.inputType.validator.maxValue)):t.inputType.validator&&t.inputType.validator.name=="STRING"&&(t.inputType.validator.maxLength>0&&i.attr("maxlength",t.inputType.validator.maxLength),t.inputType.validator.minLength>0&&i.attr("required","required"),t.inputType.validator.regularExpression&&i.attr("pattern",t.inputType.validator.regularExpression));i.on("input propertychange paste",function(){u(t,i.val())?(r.attr("data-feature-value",i.val()),i.removeClass("feature-tree-textbox-invalid")):i.addClass("feature-tree-textbox-invalid")});i.appendTo(r)}}else t.inputType.name=="COMBOBOX"&&(r.find(".feature-tree-combobox").length||(o.find(".jstree-checkbox").hide(),e=n('<select class="feature-tree-combobox" />'),_.each(t.inputType.itemSource.items,function(t){n("<option><\/option>").attr("value",t.value).text(t.displayText).appendTo(e)}),e.val(s).on("change",function(){r.attr("data-feature-value",e.val())}).appendTo(r)))})}t=r;t.on("ready.jstree",function(){f()}).on("redraw.jstree",function(){f()}).on("after_open.jstree",function(){f()}).on("create_node.jstree",function(){f()}).on("changed.jstree",function(r,u){if(u.node){var f;u.node.state.selected?(i(t.jstree("get_parent",u.node)),f=n.makeArray(t.jstree("get_node",u.node).children),t.jstree("select_node",f)):(f=n.makeArray(t.jstree("get_node",u.node).children),t.jstree("deselect_node",f))}}).jstree({types:{"default":{icon:"fa fa-folder m--font-warning"},file:{icon:"fa fa-file  m--font-warning"}},checkbox:{keep_selected_style:!1,three_state:!1,cascade:""},plugins:["checkbox","types"]})}function i(n){t.jstree("select_node",n,!0);var r=t.jstree("get_parent",n);r&&i(r)}function u(n,t){var i,r,f,u;if(!n||!n.inputType||!n.inputType.validator)return!0;if(i=n.inputType.validator,i.name=="STRING"){if(t==undefined||t==null)return i.allowNull;if(typeof t!="string"||i.minLength>0&&t.length<i.minLength||i.maxLength>0&&t.length>i.maxLength)return!1;if(i.regularExpression)return new RegExp(i.regularExpression).test(t)}else if(i.name=="NUMERIC"&&((r=parseInt(t),isNaN(r))||(f=i.minValue,f>r)||(u=i.maxValue,u>0&&r>u)))return!1;return!0}function f(){return t.find(".feature-tree-textbox-invalid").length<=0}function e(){var i=[];return t.find(".jstree-node").each(function(){var u=n(this),r=JSON.parse(u.attr("data-feature"));r.inputType&&r.inputType.name!="CHECKBOX"?i.push({name:r.name,value:u.attr("data-feature-value")}):i.push({name:r.name,value:t.jstree("is_checked",u)?"true":"false"})}),i}var t;return{init:r,getFeatureValues:e,isValid:f}}}(jQuery);