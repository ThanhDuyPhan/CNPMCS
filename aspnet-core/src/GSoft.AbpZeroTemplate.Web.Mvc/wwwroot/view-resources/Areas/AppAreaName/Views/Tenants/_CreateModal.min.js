(function(n){n.validator.addMethod("tenancyNameRegex",function(n,t,i){return i.test(n)},app.localize("TenantName_Regex_Description"));app.modals.CreateTenantModal=function(){var r=abp.services.app.tenant,t=null,u=new app.PasswordComplexityHelper,i;this.init=function(r){function y(){s.is(":checked")?(a.slideUp("fast"),v.removeAttr("required")):(a.slideDown("fast"),v.attr("required","required"))}var f,e,h,o,c,l;i=r;f=i.getModal();t=f.find("form[name=TenantInformationsForm]");t.validate({rules:{TenancyName:{tenancyNameRegex:new RegExp(t.find("input[name=TenancyName]").attr("regex"))}}});e=f.find("input[name=AdminPassword],input[name=AdminPasswordRepeat]");h=e.closest(".form-group");u.setPasswordComplexityRules(e,window.passwordComplexitySetting);n("#CreateTenant_SetRandomPassword").change(function(){n(this).is(":checked")?(h.slideUp("fast"),e.removeAttr("required")):(h.slideDown("fast"),e.attr("required","required"))});o=f.find("input[name=ConnectionString]");c=o.closest(".form-group");n("#CreateTenant_UseHostDb").change(function(){n(this).is(":checked")?(c.slideUp("fast"),o.removeAttr("required")):(c.slideDown("fast"),o.attr("required","required"))});f.find(".date-time-picker").datetimepicker({locale:abp.localization.currentLanguage.name,format:"L"});var a=f.find("input[name=SubscriptionEndDateUtc]").parent("div"),s=f.find("#CreateTenant_IsUnlimited"),v=f.find("input[name=SubscriptionEndDateUtc]");s.change(function(){y()});l=f.find("#EditionId");l.change(function(){var t=n("option:selected",this).attr("data-isfree")==="True",i=n("option:selected",this).val();i===""||t?(f.find(".subscription-component").slideUp("fast"),t?s.prop("checked",!0):s.prop("checked",!1)):f.find(".subscription-component").slideDown("fast")});y();l.trigger("change")};this.save=function(){if(t.valid()){var u=t.serializeFormToObject();u.SubscriptionEndDateUtc=n("#CreateTenant_IsUnlimited").is(":visible")&&!n("#CreateTenant_IsUnlimited").is(":checked")?n(".date-time-picker").data("DateTimePicker").date().format("YYYY-MM-DDTHH:mm:ss")+"Z":null;u.SetRandomPassword&&(u.Password=null);u.UseHostDb&&(u.ConnectionString=null);i.setBusy(!0);r.createTenant(u).done(function(){abp.notify.info(app.localize("SavedSuccessfully"));i.close();abp.event.trigger("app.createTenantModalSaved")}).always(function(){i.setBusy(!1)})}}}})(jQuery);