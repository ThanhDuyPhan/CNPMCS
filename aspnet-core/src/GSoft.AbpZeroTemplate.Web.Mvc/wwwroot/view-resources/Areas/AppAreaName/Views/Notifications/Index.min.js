(function(){$(function(){function r(n){return n.state==="READ"?"notification-read":""}function i(){o.ajax.reload()}function s(t,i){n.setAsRead(t.id,function(){i&&i()})}function h(){n.setAllAsRead(function(){i()})}function c(){n.openSettingsModal()}var u=$("#NotificationsTable"),f=abp.services.app.notification,t=$("#TargetValueFilterSelectionCombobox");t.selectpicker();var n=new app.UserNotificationHelper,e=function(t,i){var u=$("<span/>"),r=$("<button/>").addClass("btn btn-sm btn-primary").attr("title",app.localize("SetAsRead")).click(function(n){n.preventDefault();s(i,function(){r.find("i").removeClass("la-circle-o").addClass("la-check");r.attr("disabled","disabled");t.closest("tr").addClass("notification-read")})}).appendTo(u),f=$('<i class="la" >').appendTo(r),e=n.format(i).state;e==="READ"&&(r.attr("disabled","disabled"),f.addClass("la-check"));e==="UNREAD"&&f.addClass("la-circle-o");t.append(u)},o=u.DataTable({paging:!0,serverSide:!0,processing:!0,listAction:{ajaxFunction:f.getUserNotifications,inputFilter:function(){return{state:t.val()}}},columnDefs:[{className:"control responsive",orderable:!1,render:function(){return""},targets:0},{targets:1,data:null,orderable:!1,defaultContent:"",createdCell:function(n,t,i){e($(n),i)}},{targets:2,data:"notification",render:function(t,i,u){var e,f=n.format(u,!1),o=r(f);return e=f.url&&f.url!=="#"?$('<a title="'+f.text+'" href="'+f.url+'" class="'+o+'">'+abp.utils.truncateStringWithPostfix(f.text,120)+"<\/a>"):$('<span title="'+f.text+'" class="'+o+'">'+abp.utils.truncateStringWithPostfix(f.text,120)+"<\/span>"),e[0].outerHTML}},{targets:3,data:"creationTime",render:function(t,i,u){var f=n.format(u),e=r(f),o=$('<span title="'+moment(t).format("llll")+'" class="'+e+'">'+f.timeAgo+"<\/span> &nbsp;");return o[0].outerHTML}}]});t.change(function(){i()});$("#RefreshNotificationTableButton").click(function(n){n.preventDefault();i()});$("#btnOpenNotificationSettingsModal").click(function(){c()});$("#btnSetAllNotificationsAsRead").click(function(n){n.preventDefault();h()})})})();