(function(){app.modals.MySettingsModal=function(){var i=abp.services.app.profile,r=null,t,n=null;this.init=function(u){var f,e,o,s;t=u;f=t.getModal();n=f.find("form[name=MySettingsModalForm]");n.validate();r=n.find("[name='Timezone']").val();e=f.find("#btnEnableGoogleAuthenticator");e.click(function(){i.updateGoogleAuthenticatorKey().done(function(n){f.find(".google-authenticator-enable").toggle();f.find("img").attr("src",n.qrCodeSetupImageUrl)}).always(function(){t.setBusy(!1)})});o=f.find("#btnSmsVerification");s=new app.ModalManager({viewUrl:abp.appPath+"AppAreaName/Profile/SmsVerificationModal",scriptUrl:abp.appPath+"view-resources/Areas/AppAreaName/Views/Profile/_SmsVerificationModal.js",modalClass:"SmsVerificationModal"});o.click(function(){i.sendVerificationSms().done(function(){s.open({},function(){$("#SpanSmsVerificationVerified").show();$("#SpanSmsVerificationUnverified").hide();n.find(".tooltips").tooltip()})})});n.find(".tooltips").tooltip()};this.save=function(){if(n.valid()){var u=n.serializeFormToObject();t.setBusy(!0);i.updateCurrentUserProfile(u).done(function(){$("#HeaderCurrentUserName").text(u.UserName);abp.notify.info(app.localize("SavedSuccessfully"));t.close();var i=n.find("[name='Timezone']").val();abp.clock.provider.supportsMultipleTimezone&&r!==i&&abp.message.info(app.localize("TimeZoneSettingChangedRefreshPageNotification")).done(function(){window.location.reload()})}).always(function(){t.setBusy(!1)})}}}})();