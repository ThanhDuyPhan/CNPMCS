(function(n){app.modals.ChangeProfilePictureModal=function(){var r,t=null,i=null,u=abp.services.app.profile;this.init=function(u){r=u;n("#ChangeProfilePictureModalForm input[name=ProfilePicture]").change(function(){n("#ChangeProfilePictureModalForm").submit()});n("#ChangeProfilePictureModalForm").ajaxForm({beforeSubmit:function(){var u=n("#ChangeProfilePictureModalForm input[name=ProfilePicture]"),i=u.get()[0].files,t,r;return i.length?(t=i[0],r="|"+t.type.slice(t.type.lastIndexOf("/")+1)+"|","|jpg|jpeg|png|gif|".indexOf(r)===-1)?(abp.message.warn(app.localize("ProfilePicture_Warn_FileType")),!1):t.size>5242880?(abp.message.warn(app.localize("ProfilePicture_Warn_SizeLimit",app.maxProfilPictureBytesUserFriendlyValue)),!1):!0:!1},success:function(r){if(r.success){var u=n("#ProfilePictureResize"),f=abp.appPath+"Temp/Downloads/"+r.result.fileName+"?v="+(new Date).valueOf();i=r.result.fileName;t&&t.destroy();u.show();u.attr("src",f);u.attr("originalWidth",r.result.width);u.attr("originalHeight",r.result.height);u.Jcrop({setSelect:[0,0,100,100],aspectRatio:1,boxWidth:400,boxHeight:400},function(){t=this})}else abp.message.error(r.error.message)}});n("#ProfilePictureResize").hide()};this.save=function(){var f,e,o;if(i){f={};t&&(f=t.getSelection());var s=t.getContainerSize()[0],h=t.getContainerSize()[1],c=s,l=h;n("#ProfilePictureResize")&&(c=parseInt(n("#ProfilePictureResize").attr("originalWidth")),l=parseInt(n("#ProfilePictureResize").attr("originalHeight")));e=c/s;o=l/h;u.updateProfilePicture({fileName:i,x:parseInt(f.x*e),y:parseInt(f.y*o),width:parseInt(f.w*e),height:parseInt(f.h*o)}).done(function(){t.destroy();t=null;n(".header-profile-picture").attr("src",app.getUserProfilePicturePath());r.close()})}}}})(jQuery);